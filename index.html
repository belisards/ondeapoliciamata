<!DOCTYPE html>
<head>
    <meta charset="utf-8">

    <title>Onde A Polícia Mata?</title>
	<script src="https://d3js.org/d3.v4.min.js"></script>
	<script src="https://d3js.org/topojson.v2.min.js"></script>
    <link href="estilo.css" rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300" type="text/css" />
	</head>	

<body>
  <div id="sliderContainer">
        <input id="timeslide" type="range" min="0" max="4" value="0" step="1"/><br>
        <span id="range">2017</span>
    </div>
	 <div id="title">
        <img src="http://ondeapoliciamata.org/img/logo.png"></img></div></body>
<!--         <h1>Onde A Polícia Mata?</h1>
 -->        <h3>Homícidios decorrentes de intervenção policial no Rio de Janeiro</h3>
    </div>

  

    <div id="map"></div>
    <div class="tooltip"></div>

<script>  

// define var
var width = 500;
var height = 215;

var inputValue = null;
var time = ["2010","2011","2012","2013","2014"];


var projection = d3.geoMercator();
var path = d3.geoPath().projection(projection);

// responsivo

var svg = d3.select("#map")
    .classed("svg-cont", true)
    .append("svg")
    .attr("preserveAspectRatio", "xMinYMin meet")
    .attr("viewBox", "0 0 560 250")
    .classed("svg-content-responsive", true)
  .append("g");




d3.json("rioauto.json", function(error, aisp) {

        projection.fitSize([width,height], topojson.feature(aisp, aisp.objects.convert));
         
        svg.append("g")
          .attr("class", "regiao")
          .selectAll("path")
          .data(topojson.feature(aisp, aisp.objects.convert).features)
          .enter().append("path")
          .attr("d", path) 
          .on('mouseover', tipMouseOver)
          .on("mouseout", tipMouseOut)
      }); 


//tooltip
tipMouseOver = function(d, i) {
        d3.select(".tooltip").html("<br><b>AISP " + d.properties.AISP + "</b>" 
                               + "<br>2010: " + d.properties.dez
                               + "<br>2011: " + d.properties.onze
                               + "<br>2012: " + d.properties.doze
                               + "<br>2013: " + d.properties.treze
                               + "<br>2014: " + d.properties.catorze
                               + "<br>2015: " + d.properties.quinze
                               + "<br>2016: " + d.properties.dezeseis
                               + "<br>2017: " + d.properties.dezesete
                                ).transition()
                      .duration(500) // ms
                      .style("opacity", 100);                   
      }

 var tipMouseOut = function(d) {
                  d3.select(".tooltip").transition()
                      .duration(500) // ms
                      .style("opacity", 0); // don't care about position!
              };
/// zoom


   // when the input range changes update the rectangle 
    d3.select("#timeslide").on("input", function() {
        update(+this.value);
    });

    function update(value) {
        document.getElementById("range").innerHTML=time[value];
        inputValue = time[value];
        d3.selectAll("path")
            .style("fill", timeMatch)
            ;
    }

    function timeMatch(aisp) {
        if (inputValue == "2010") {
            if (aisp.properties.dez < "10") {
                return 'blue'
            }
            if (aisp.properties.dez > "11" && aisp.properties.onze < "30") {
                return 'yellow'
            }
            if (aisp.properties.dez >= "30") {
                return 'red'
            }
             else {
                return 'pink'
            }

        } else if (inputValue == "2011") {

            if (aisp.properties.onze < "36") {
                return '#fee8c8'
            }
            if (aisp.properties.onze >= "24" && aisp.properties.onze < "100" ) {
                return '#fdbb84'
            }
            if (aisp.properties.onze >= "100") {
                return '#e34a33'
            }
             else {
                return 'pink'
            }

        } else if (inputValue == "2012") {
            if (aisp.properties.RISP == "1") {
                return '#084594'
            } else {
                return '#cb181d'
            }
        // } else if (inputValue == "2013") {
        //     if (data.properties.RISP == "4") {
        //         return '#084594'
        //     } else {
        //         return '#cb181d'
        //     }
        // } else if (inputValue == "2014") {
        //     if (data.properties.RISP == "5") {
        //         return '#084594'
        //     } else {
        //         return '#cb181d'
        //     }
        };
    }

    function initialState(data){
        if (document.getElementById("range").innerHTML == 2017) {
            if (aisp.properties.dez < "10") {
                return 'blue'
            }
            if (aisp.properties.dez > "11" && aisp.properties.onze < "30") {
                return 'yellow'
            }
            if (aisp.properties.dez >= "30") {
                return 'red'
            }
             else {
                return 'pink'
            }
        };

}


</script>